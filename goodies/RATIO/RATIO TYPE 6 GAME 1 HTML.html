<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Age Ratio Problem (Fixed)</title>
<style>
  :root{--bg:#fff;--card:#fff;--muted:#666;--accent:#0b59c6;}
  html,body{
    height:100%;margin:0;background:var(--bg);
    font-family:Segoe UI,Roboto,Arial,sans-serif;color:#111;
  }
  .wrap{min-height:100%;display:flex;align-items:center;justify-content:center;padding:20px;}
  .card{width:100%;max-width:1000px;background:var(--card);border-radius:10px;padding:22px 20px;
    box-shadow:0 8px 28px rgba(16,49,90,0.06);}
  h1{font-size:16px;margin:0 0 10px;font-weight:700;}
  .question{font-size:20px;color:var(--accent);margin:12px 0;font-weight:700;}
  .prompt{color:var(--muted);font-size:13px;margin-bottom:10px;font-style:italic;}
  .steps{white-space:pre-line;font-size:17px;line-height:1.55;margin-top:12px;}
  .hidden{display:none;}
  .foot{margin-top:10px;color:var(--muted);font-size:13px;}
  .goodbye{padding:48px;text-align:center;font-size:20px;color:#333;}
  .box{display:inline-block;border:2px solid #7aa6ff;padding:2px 6px;border-radius:6px;background:#eaf2ff;margin-left:4px;}
</style>
</head>

<body>
<div class="wrap">
  <div class="card" id="card" role="main" aria-live="polite">
    <h1>Age Ratio Problem (Fixed)</h1>
    <div class="question" id="qText">—</div>
    <div class="prompt" id="prompt">Press any key to reveal all steps…</div>
    <div id="stepsBox" class="steps hidden"></div>
    <div class="foot">After reveal press <b>y</b> for next or <b>n</b> to exit.</div>
  </div>
</div>

<script>
(function(){ 

// ------------------------------
// PERSON TYPES
// ------------------------------
const PERSONS = [
 ["two siblings","sibling"],["two cousins","cousin"],["two brothers","brother"],
 ["two sisters","sister"],["two twins","twin"],["two relatives","relative"],
 ["two grandparents","grandparent"],["two parents","parent"],["two friends","friend"],
 ["two classmates","classmate"],["two schoolmates","schoolmate"],["two partners","partner"],
 ["two neighbors","neighbor"],["two teammates","teammate"],["two colleagues","colleague"],
 ["two workers","worker"],["two officers","officer"],["two employees","employee"],
 ["two soldiers","soldier"],["two scientists","scientist"],["two athletes","athlete"],
 ["two players","player"],["two swimmers","swimmer"],["two runners","runner"],
 ["two competitors","competitor"],["two students","student"],["two teachers","teacher"],
 ["two travelers","traveler"],["two artists","artist"],["two musicians","musician"]
];

// ------------------------------
// QUESTION VARIANTS
// ------------------------------
const VARIANTS = [
 (pl,A,B,K,C,D)=> `The ages of ${pl} are in the ratio ${A}:${B}. ${K} years ago, their ages were in the ratio ${C}:${D}. Find their present ages.`,
 (pl,A,B,K,C,D)=> `At present, the age ratio of ${pl} is ${A}:${B}. Exactly ${K} years earlier, they were in the ratio ${C}:${D}. Determine how old each one is today.`,
 (pl,A,B,K,C,D)=> `${K} years ago, ${pl} had ages in the ratio ${C}:${D}. Today their ages stand in the ratio ${A}:${B}. Calculate the current ages of both individuals.`
];

function gcd(a,b){ a=Math.abs(a); b=Math.abs(b); while(b){ const t=a%b; a=b; b=t;} return a; }
function simplify(a,b){ const g=gcd(a,b); return [a/g,b/g]; }
function r(a,b){ return Math.floor(Math.random()*(b-a+1))+a; }

// -----------------------------------------------------------
// COPRIME-BASED, SCALE-BASED AGE GENERATOR (Corrected)
// -----------------------------------------------------------
function generateProblem(){

  const COPRIMES = [
    [3,4],[3,5],[4,7],[5,7],[5,8],[7,9],
    [8,11],[9,11],[11,13],[7,10],[6,11],[5,9],[4,5],[3,7]
  ];

  let p,q,s,x,y,K,xp,yp,A,B,C,D;

  while(true){
    [p,q] = COPRIMES[r(0, COPRIMES.length-1)];
    s = r(3,15);
    x = p*s;
    y = q*s;
    if(x >= 100 || y >= 100) continue;
    K = r(5,18);
    if(x - K <= 0 || y - K <= 0) continue;
    xp = x - K;
    yp = y - K;
    [A,B] = simplify(p,q);
    [C,D] = simplify(xp, yp);
    if(A === C && B === D) continue;
    break;
  }

  const [plural, singular] = PERSONS[r(0,PERSONS.length-1)];
  const v = VARIANTS[r(0,VARIANTS.length-1)];
  const question = v(plural, A,B, K, C,D);

  return {x,y,K,xp,yp,A,B,C,D,plural,singular,question};
}

// -----------------------------------------------------------
// REST OF THE CODE UNCHANGED (verification removed)
// -----------------------------------------------------------
let DATA=null; let stage="question";
const qEl=document.getElementById("qText");
const stepsEl=document.getElementById("stepsBox");
const prompt=document.getElementById("prompt");

function newProblem(){
  stage="question";
  stepsEl.classList.add("hidden");
  stepsEl.textContent="";
  prompt.textContent="Press any key to reveal all steps…";
  DATA = generateProblem();
  qEl.textContent = DATA.question;
}

function reveal(){
  stage="answer";
  prompt.textContent='Press "y" for next or "n" to exit.';
  stepsEl.classList.remove("hidden");

  const {x,y,K,xp,yp,A,B,C,D,plural,singular} = DATA;

  let t="";
  t+="Step 1 — Let present ages be:\n";
  t+="Age of 1st "+singular+" = x = "+A+"a\n";
  t+="Age of 2nd "+singular+" = y = "+B+"a\n\n";

  t+="Case of "+K+" years ago:\n";
  t+="Age of 1st "+singular+" "+K+" years ago = x - "+K+" = "+A+"a - "+K+"\n";
  t+="Age of 2nd "+singular+" "+K+" years ago = y - "+K+" = "+B+"a - "+K+"\n\n";

  t+="Ratio "+K+" years ago:\n";
  t+="( "+A+"a - "+K+" ) / ( "+B+"a - "+K+" ) = "+C+" / "+D+"\n\n";

  t+="Solving equation for a, using cross multiplication:\n";
  t+="⇒ ( "+A+"a - "+K+" )( "+D+" ) = ( "+C+" )( "+B+"a - "+K+" )\n\n";

  let L1 = A * D;
  let L2 = K * D;
  let R1 = C * B;
  let R2 = C * K;

  t+="Expand both sides:\n";
  t+="Left → "+L1+"a - "+L2+"\n";
  t+="Right → "+R1+"a - "+R2+"\n\n";

  t+="Bring terms to left side (subtract right side):\n";
  t+="⇒ "+L1+"a - "+L2+" - "+R1+"a + "+R2+" = 0\n";

  let coef = L1 - R1;
  let constSum = -L2 + R2;

  t+="⇒ "+coef+"a + ("+constSum+") = 0\n\n";

  const RHS = -constSum;   // = L2 - R2

  t+="Isolate a:\n";
  t+="⇒ "+coef+"a = "+RHS+"\n";

  let a = RHS / coef;

  t+="⇒ a = "+RHS+" ÷ "+coef+" = "+a+"\n\n";

  t+="Substitute a = "+a+" into x & y:\n";
  t+="x = "+A+"a = "+A+"×"+a+" = "+x+" years\n";
  t+="y = "+B+"a = "+B+"×"+a+" = "+y+" years\n\n";

  t+="Final Answers:\n";
  t+="Present age of 1st "+singular+" = "+x+" years\n";
  t+="Present age of 2nd "+singular+" = "+y+" years\n\n";

  stepsEl.textContent=t;
}

window.addEventListener("keydown", e=>{
  const k=(e.key||"").toLowerCase();
  if(stage==="question"){ reveal(); }
  else if(stage==="answer"){
    if(k==="y") newProblem();
    else if(k==="n"){
      document.getElementById("card").innerHTML =
        '<div class="goodbye">Goodbye — thanks for learning!<br><span style="color:#777;font-size:13px">You may now close this tab.</span></div>';
    }
  }
});

document.addEventListener("selectstart",e=>e.preventDefault());
newProblem();

})();
</script>

</body>
</html>
