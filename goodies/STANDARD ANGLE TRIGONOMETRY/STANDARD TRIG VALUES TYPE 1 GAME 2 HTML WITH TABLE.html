<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Advanced Trig Evaluator with Reference</title>
<style>
  body {
    margin: 0;
    padding: 20px;
    font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
    background-color: #f0f2f5;
    color: #333;
    display: flex;
    justify-content: center;
    min-height: 100vh;
  }

  .card {
    background: #fff;
    width: 100%;
    max-width: 850px;
    padding: 40px;
    border-radius: 16px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.08);
    display: flex;
    flex-direction: column;
    gap: 24px;
  }

  h1 {
    font-size: 22px;
    font-weight: 700;
    color: #444;
    margin: 0 0 10px 0;
    border-bottom: 2px solid #eee;
    padding-bottom: 15px;
  }

  .math-row {
    display: flex;
    align-items: center;
    flex-wrap: wrap;
    font-size: 20px;
    min-height: 50px;
    margin-bottom: 15px;
    line-height: 1.5;
  }

  .label {
    font-weight: bold;
    margin-right: 15px;
    color: #007bff;
    min-width: 60px;
    font-size: 14px;
    text-transform: uppercase;
  }

  .math-group {
    display: inline-flex;
    align-items: center;
    background: #f9f9f9;
    padding: 4px 8px;
    border-radius: 6px;
  }

  .frac {
    display: inline-flex;
    flex-direction: column;
    align-items: center;
    vertical-align: middle;
    margin: 0 4px;
    font-size: 0.9em;
  }
  .frac .num {
    border-bottom: 1px solid #333;
    padding: 0 4px 2px 4px;
    text-align: center;
    display: block;
  }
  .frac .den {
    padding: 2px 4px 0 4px;
    text-align: center;
    display: block;
  }

  .op {
    margin: 0 12px;
    font-weight: bold;
    color: #555;
  }
  
  .box {
    border: 2px solid #28a745;
    padding: 12px 20px;
    border-radius: 8px;
    background: #eaffea;
    font-weight: bold;
    margin-top: 10px;
    font-size: 22px;
  }

  /* Reference Table Styles */
  .ref-container {
    margin-top: 30px;
    padding-top: 20px;
    border-top: 2px dashed #eee;
  }
  .ref-title {
    font-size: 14px;
    font-weight: bold;
    color: #666;
    margin-bottom: 10px;
  }
  table.trig-ref {
    width: 100%;
    border-collapse: collapse;
    font-size: 14px;
    text-align: center;
  }
  table.trig-ref th, table.trig-ref td {
    border: 1px solid #ddd;
    padding: 8px;
  }
  table.trig-ref th {
    background-color: #f8f9fa;
  }
  .undef { color: #dc3545; font-style: italic; }

  .prompt {
    margin-top: auto;
    font-size: 14px;
    color: #888;
    text-align: center;
    font-style: italic;
    padding-top: 20px;
  }
</style>
</head>
<body>

<main class="card" id="card">
  <div>
    <h1>Trigonometric Evaluator</h1>
  </div>
  <div id="content"></div>
  <div class="prompt" id="prompt">Press any key to reveal solution</div>
</main>

<script>
(function(){
"use strict";

const content = document.getElementById("content");
const prompt  = document.getElementById("prompt");
let state = "question";

const TRIG_VALUES = {
  "sin":   { "0": [0,0,1], "30": [1,1,2], "45": [1,2,2], "60": [1,3,2], "90": [1,1,1] },
  "cos":   { "0": [1,1,1], "30": [1,3,2], "45": [1,2,2], "60": [1,1,2], "90": [0,0,1] },
  "tan":   { "0": [0,0,1], "30": [1,3,3], "45": [1,1,1], "60": [1,3,1], "90": null },
  "cot":   { "0": null,    "30": [1,3,1], "45": [1,1,1], "60": [1,3,3], "90": [0,0,1] },
  "sec":   { "0": [1,1,1], "30": [2,3,3], "45": [1,2,1], "60": [2,1,1], "90": null },
  "cosec": { "0": null,    "30": [2,1,1], "45": [1,2,1], "60": [2,3,3], "90": [1,1,1] }
};

function gcd(a, b) { return b === 0 ? Math.abs(a) : gcd(b, a % b); }
function lcm(a, b) { return (a === 0 || b === 0) ? 0 : Math.abs(a * b) / gcd(a, b); }

class Term {
  constructor(coeff, root, den) {
    this.c = coeff; this.r = root; this.d = den;
    this.simplify();
  }
  simplify() {
    if (this.c === 0) { this.r = 0; this.d = 1; return; }
    let k = 2;
    while (k * k <= this.r) {
      if (this.r % (k * k) === 0) { this.c *= k; this.r /= (k * k); } else { k++; }
    }
    let common = gcd(this.c, this.d);
    this.c /= common; this.d /= common;
    if (this.d < 0) { this.c *= -1; this.d *= -1; }
  }
  multiply(other) { return new Term(this.c * other.c, this.r * other.r, this.d * other.d); }
  toHTML() {
    if (this.c === 0) return "0";
    let numStr = (Math.abs(this.c) === 1 && this.r !== 1) ? (this.c === -1 ? "−" : "") + `√${this.r}` : this.c.toString() + (this.r !== 1 ? `√${this.r}` : "");
    if (this.d === 1) return numStr;
    return `<div class="frac"><span class="num">${numStr}</span><span class="den">${this.d}</span></div>`;
  }
}

function getTrigTerm() {
  const funcs = ["sin", "cos", "tan", "cot", "sec", "cosec"];
  const angles = ["0", "30", "45", "60", "90"];
  const f = funcs[Math.floor(Math.random() * funcs.length)];
  const a = angles[Math.floor(Math.random() * angles.length)];
  const raw = TRIG_VALUES[f][a];
  if (raw === null) return { text: `${f} ${a}°`, isUndefined: true, term: null };
  const termObj = new Term(raw[0], raw[1], raw[2]);
  return { text: `${f} ${a}°`, isUndefined: false, term: termObj, display: termObj.toHTML() };
}

let t1, t2, t3, t4, op;

function generateProblem() {
  t1 = getTrigTerm(); t2 = getTrigTerm(); t3 = getTrigTerm(); t4 = getTrigTerm();
  op = Math.random() < 0.5 ? 1 : -1;
}

function getReferenceTable() {
  return `
    <div class="ref-container">
      <div class="ref-title">Reference: Standard Trigonometric Values</div>
      <table class="trig-ref">
        <tr><th>Ratio</th><th>0°</th><th>30°</th><th>45°</th><th>60°</th><th>90°</th></tr>
        ${Object.keys(TRIG_VALUES).map(ratio => `
          <tr>
            <td><strong>${ratio}</strong></td>
            ${["0", "30", "45", "60", "90"].map(angle => {
              const val = TRIG_VALUES[ratio][angle];
              if (!val) return `<td class="undef">undef.</td>`;
              return `<td>${new Term(val[0], val[1], val[2]).toHTML()}</td>`;
            }).join('')}
          </tr>
        `).join('')}
      </table>
    </div>`;
}

function render() {
  const opChar = op === 1 ? "+" : "−";
  let html = `<div class="math-row"><span class="label">Evaluate:</span> ${t1.text} · ${t2.text} <span class="op">${opChar}</span> ${t3.text} · ${t4.text}</div>`;

  if (state === "answer") {
    if (t1.isUndefined || t2.isUndefined || t3.isUndefined || t4.isUndefined) {
      html += `<div class="math-row"><span class="label">Result:</span><div class="box" style="color:#dc3545; border-color:#dc3545; background:#fff5f5;">Undefined</div></div>`;
    } else {
      let p1 = t1.term.multiply(t2.term);
      let p2 = t3.term.multiply(t4.term);
      const cDen = lcm(p1.d, p2.d);
      let fC1 = p1.c * (cDen/p1.d), fC2 = p2.c * (cDen/p2.d) * op;
      
      html += `<div class="math-row"><span class="label">Step 1:</span>(${t1.display})(${t2.display}) <span class="op">${opChar}</span> (${t3.display})(${t4.display})</div>`;
      html += `<div class="math-row"><span class="label">Step 2:</span>${p1.toHTML()} <span class="op">${opChar}</span> ${p2.toHTML()}</div>`;

      let final;
      if (fC1 === 0 && fC2 === 0) final = "0";
      else if (p1.r === p2.r) final = new Term(fC1 + fC2, p1.r, cDen).toHTML();
      else {
        let common = gcd(gcd(fC1, fC2), cDen);
        let n1 = new Term(fC1/common, p1.r, 1).toHTML(), n2 = new Term(fC2/common, p2.r, 1).toHTML();
        let num = n1 + (fC2 > 0 ? " + " : " ") + n2;
        final = (cDen/common === 1) ? num : `<div class="frac"><span class="num">${num}</span><span class="den">${cDen/common}</span></div>`;
      }
      html += `<div class="math-row"><span class="label">Answer:</span><div class="box">${final}</div></div>`;
    }
    html += getReferenceTable();
    prompt.textContent = "Press 'y' for next or 'n' to exit.";
  }
  content.innerHTML = html;
}

generateProblem();
render();

window.addEventListener("keydown", e => {
  const k = e.key.toLowerCase();
  if (state === "question") { state = "answer"; render(); }
  else if (k === "y") { state = "question"; generateProblem(); render(); }
  else if (k === "n") { document.getElementById("card").innerHTML = "<h1>Session Ended</h1>"; }
});
})();
</script>
</body>
</html>