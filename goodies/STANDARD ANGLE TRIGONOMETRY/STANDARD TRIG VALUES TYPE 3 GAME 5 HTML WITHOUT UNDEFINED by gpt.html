<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>cos(2A) Identity Verification</title>

<style>
body{ margin:0; padding:24px; font-family:"Segoe UI", Roboto, Arial, sans-serif; background:#ffffff; color:#111; }
.card{ max-width:900px; margin:auto; padding:28px; border-radius:12px; box-shadow:0 8px 26px rgba(0,0,0,0.08); }
.q{ font-size:18px; font-weight:700; margin-bottom:14px; }
.line{ font-size:16px; margin:8px 0; line-height:1.7; }
.frac{ display:inline-block; text-align:center; vertical-align:middle; margin:0 4px; }
.frac .num{ display:block; border-bottom:1px solid #111; padding:0 6px; }
.frac .den{ display:block; padding:0 6px; }
.box{ display:inline-block; padding:6px 14px; border:2px solid #111; font-weight:700; background:#f9f9f9; }
.step-header{ font-weight:600; color:#444; margin-top:20px; text-decoration:underline; }
.sub-step{ margin-left:20px; color:#333; font-size:15px; font-weight:600; margin-top:12px; }
.prompt{ margin-top:16px; font-size:13px; font-style:italic; color:#555; }
</style>
</head>

<body>
<main class="card" id="card">
  <div id="content"></div>
  <div class="prompt" id="prompt">
    Press any key to reveal the solution. After reveal press <b>y</b> for next or <b>n</b> to exit.
  </div>
</main>

<script>
(function(){
"use strict";

/* ===================== ENGINE ===================== */
/* Value structure: (a + c√3) / k */

function Val(a,b,c,d,k){ return {a,b,c,d,k}; }
function gcd(x,y){ return y?gcd(y,x%y):Math.abs(x); }

function simplify(v){
  if(v.a===0 && v.c===0) return Val(0,0,0,0,1);
  let g=gcd(Math.abs(v.a),gcd(Math.abs(v.c),v.k));
  return Val(v.a/g,0,v.c/g,0,v.k/g);
}

function add(v1,v2){
  return simplify(Val(
    v1.a*v2.k+v2.a*v1.k,
    0,
    v1.c*v2.k+v2.c*v1.k,
    0,
    v1.k*v2.k
  ));
}

function sub(v1,v2){
  return add(v1,Val(-v2.a,0,-v2.c,0,v2.k));
}

function mul(v1,v2){
  return simplify(Val(
    v1.a*v2.a + 3*v1.c*v2.c,
    0,
    v1.a*v2.c + v1.c*v2.a,
    0,
    v1.k*v2.k
  ));
}

function divScalar(num,den){
  if(den.a===0) return Val(0,0,0,0,1);
  return simplify(Val(
    num.a*den.k,
    0,
    num.c*den.k,
    0,
    num.k*den.a
  ));
}

/* ===================== DISPLAY ===================== */

function fracHTML(n,d){
  return `<span class="frac"><span class="num">${n}</span><span class="den">${d}</span></span>`;
}

function numHTML(v){
  let s=[];
  if(v.a) s.push(`${v.a}`);
  if(v.c) s.push(v.c===1?"√3":v.c===-1?"−√3":`${v.c}√3`);
  if(!s.length) return "0";
  return s.join(" + ").replace(/\+\s−/g,"− ");
}

function valHTML(v){
  let n=numHTML(v);
  return v.k===1?n:fracHTML(n,v.k);
}

/* ===================== TABLES ===================== */

const tanTable={
  0:  Val(0,0,0,0,1),
  30: Val(0,0,1,0,3),
  45: Val(1,0,0,0,1)
};

const cos2ATable={
  0:  Val(1,0,0,0,1),
  60: Val(1,0,0,0,2),
  90: Val(0,0,0,0,1)
};

/* ===================== VALID A ===================== */
/* Ensures A ∈ {0,30,45} and 2A ≤ 90 */

const angles=[0,30,45];

const content=document.getElementById("content");
const prompt=document.getElementById("prompt");
let stage="q",A;

function gen(){
  A=angles[Math.floor(Math.random()*angles.length)];
}

function showQ(){
  content.innerHTML=`
    <div class="q">Verify the identity:</div>
    <div class="line" style="font-size:1.1em;">
      cos&nbsp;2A =
      <span class="frac">
        <span class="num">1 − tan²A</span>
        <span class="den">1 + tan²A</span>
      </span>
    </div>
    <div class="line">
      Given that <b>A = ${A}°</b>
    </div>
  `;
  stage="q";
}

function showA(){
  const cos2A = cos2ATable[2*A];
  const tanA = tanTable[A];

  const tanSq = mul(tanA,tanA);
  const num = sub(Val(1,0,0,0,1),tanSq);
  const den = add(Val(1,0,0,0,1),tanSq);
  const RHS = divScalar(num,den);

  content.innerHTML+=`
    <hr style="margin:20px 0">

    <div class="step-header">Step 1: Evaluate LHS</div>
    <div class="line">⇒ cos(2A)</div>
    <div class="line">⇒ cos(${2*A}°)</div>
    <div class="line"><b>${valHTML(cos2A)}</b></div>

    <div class="step-header">Step 2: Evaluate RHS</div>
    <div class="line">⇒ (1 − tan²A) / (1 + tan²A)</div>
    <div class="line">⇒ (1 − tan²${A}°) / (1 + tan²${A}°)</div>

    <div class="sub-step">2a. Compute tan²A:</div>
    <div class="line">⇒ (${valHTML(tanA)})²</div>
    <div class="line"><b>${valHTML(tanSq)}</b></div>

    <div class="sub-step">2b. Numerator (1 − tan²A):</div>
    <div class="line">⇒ 1 − ${valHTML(tanSq)}</div>
    <div class="line"><b>${valHTML(num)}</b></div>

    <div class="sub-step">2c. Denominator (1 + tan²A):</div>
    <div class="line">⇒ 1 + ${valHTML(tanSq)}</div>
    <div class="line"><b>${valHTML(den)}</b></div>

    <div class="sub-step">2d. Divide Numerator by Denominator:</div>
    <div class="line">
      ⇒ <span class="frac">
        <span class="num">${valHTML(num)}</span>
        <span class="den">${valHTML(den)}</span>
      </span>
    </div>
    <div class="line"><b>${valHTML(RHS)}</b></div>

    <div class="step-header">Step 3: Conclusion</div>
    <div class="line">
      <span class="box">${valHTML(cos2A)} = ${valHTML(RHS)}</span>
    </div>
    <div class="line"><b>Identity Verified.</b></div>
  `;
  prompt.textContent="Press y for next or n to exit.";
  stage="a";
}

gen(); showQ();

window.addEventListener("keydown",e=>{
  const k=(e.key||"").toLowerCase();
  if(stage==="q") showA();
  else if(k==="y"){ gen(); showQ(); prompt.textContent="Press any key to reveal the solution."; }
  else if(k==="n"){ document.getElementById("card").innerHTML="<div class='q'>Session ended.</div>"; }
});
})();
</script>
</body>
</html>
