<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Tan(A-B) Identity Verification</title>

<style>
body{
  margin:0;
  padding:24px;
  font-family:"Segoe UI", Roboto, Arial, sans-serif;
  background:#ffffff;
  color:#111;
}
.card{
  max-width:900px;
  margin:auto;
  padding:28px;
  border-radius:12px;
  box-shadow:0 8px 26px rgba(0,0,0,0.08);
}
.q{ font-size:18px; font-weight:700; margin-bottom:14px; }
.line{ font-size:16px; margin:8px 0; line-height:1.7; }
.frac{
  display:inline-block;
  text-align:center;
  vertical-align:middle;
  margin:0 4px;
}
.frac .num{ display:block; border-bottom:1px solid #111; padding:0 6px; }
.frac .den{ display:block; padding:0 6px; }
.box{
  display:inline-block;
  padding:6px 14px;
  border:2px solid #111;
  font-weight:700;
  background-color:#f9f9f9;
}
.step-header{
  font-weight:600;
  color:#444;
  margin-top:20px;
  text-decoration:underline;
  text-decoration-color:#ddd;
}
.sub-step{
  margin-left: 20px;
  color: #333;
  font-size: 15px;
}
.prompt{
  margin-top:16px;
  font-size:13px;
  font-style:italic;
  color:#555;
}
</style>
</head>

<body>
<main class="card" id="card">
  <div id="content"></div>
  <div class="prompt" id="prompt">
    Press any key to reveal the solution. After reveal press <b>y</b> for next or <b>n</b> to exit.
  </div>
</main>

<script>
(function(){
"use strict";

/* ===================== ENGINE ===================== */

// Value structure: (a + c√3) / k
// b and d (for √2, √6) are kept 0 for Tangent standard angles.
function Val(a,b,c,d,k){ return {a,b,c,d,k}; }

function gcd(x,y){ return y?gcd(y,x%y):Math.abs(x); }

function simplify(v){
  if(v.a===0 && v.b===0 && v.c===0 && v.d===0) return Val(0,0,0,0,1);
  let g=gcd(gcd(gcd(gcd(Math.abs(v.a),Math.abs(v.b)),Math.abs(v.c)),Math.abs(v.d)),v.k);
  return Val(v.a/g,v.b/g,v.c/g,v.d/g,v.k/g);
}

function add(v1,v2){
  let k=v1.k*v2.k;
  return simplify(Val(
    v1.a*v2.k+v2.a*v1.k,
    0, // b unused
    v1.c*v2.k+v2.c*v1.k,
    0, // d unused
    k
  ));
}

function sub(v1,v2){
  // v1 - v2
  return add(v1, Val(-v2.a, 0, -v2.c, 0, v2.k));
}

function mul(v1,v2){
  // (a1 + c1√3)(a2 + c2√3) = (a1a2 + 3c1c2) + (a1c2 + c1a2)√3
  return simplify(Val(
    v1.a*v2.a + 3*v1.c*v2.c,
    0,
    v1.a*v2.c + v1.c*v2.a,
    0,
    v1.k*v2.k
  ));
}

// Special division used here:
// For the standard pairs provided, the Denominator (1 + tanA tanB) 
// is ALWAYS rational (e.g., 1, 2, 4, 4/3). 
// It never contains a √3 term. 
// Thus, we simply multiply the Numerator by the reciprocal of the Denominator.
function divScalar(vNum, vDen){
    // vDen is assumed to be rational: a/k
    // Result = vNum * (k/a)
    // New Numerator scalar = vDen.k
    // New Denominator scalar = vDen.a
    
    // Safety check for 0 division
    if(vDen.a === 0) return Val(0,0,0,0,1); // Should not happen in this identity
    
    let k_new = vNum.k * vDen.a;
    
    return simplify(Val(
        vNum.a * vDen.k,
        0,
        vNum.c * vDen.k,
        0,
        k_new
    ));
}

/* ===================== DISPLAY ===================== */

function fracHTML(n,d){
  return `<span class="frac"><span class="num">${n}</span><span class="den">${d}</span></span>`;
}

function numHTML(v){
  let s=[];
  if(v.a) s.push(`${v.a}`);
  // We only use c (√3) for Tan 30/60
  if(v.c) s.push(v.c===1?"√3":v.c===-1?"−√3":`${v.c}√3`);
  
  if(!s.length) return "0";
  return s.join(" + ").replace(/\+\s[−-]/g,"− ").replace(/-/g,"−");
}

function valHTML(v){
  let n=numHTML(v);
  return v.k===1?n:fracHTML(n,v.k);
}

/* ===================== TRIG TABLE ===================== */

const tanTable={
    0:  Val(0,0,0,0,1),
    30: Val(0,0,1,0,3), // 1/√3 = √3/3
    45: Val(1,0,0,0,1), // 1
    60: Val(0,0,1,0,1)  // √3
};

/* ===================== VALID (A,B) PAIRS ===================== */
/* Constraints: 
   1. A, B in {0, 30, 45, 60}
   2. A - B in {0, 30, 45, 60} 
   
   Note: (45, 30) yields 15 (Excluded). (60, 45) yields 15 (Excluded).
*/

const pairs=[
  [0,0],    // 0
  [30,0],   // 30
  [30,30],  // 0
  [45,0],   // 45
  [45,45],  // 0
  [60,0],   // 60
  [60,30],  // 30
  [60,60]   // 0
];

const content=document.getElementById("content");
const prompt=document.getElementById("prompt");
let stage="q",A,B;

function gen(){
  const p=pairs[Math.floor(Math.random()*pairs.length)];
  A=p[0]; B=p[1];
}

function showQ(){
  content.innerHTML=`
    <div class="q">Verify the identity:</div>
    <div class="line" style="font-size:1.1em;">
      tan(A − B) = <span class="frac"><span class="num">tanA − tanB</span><span class="den">1 + tanA tanB</span></span>
    </div>
    <div class="line">
      Given that <b>A = ${A}°</b> and <b>B = ${B}°</b>
    </div>
  `;
  stage="q";
}

function showA(){
  const tanDiff = tanTable[A-B];
  const tanA = tanTable[A];
  const tanB = tanTable[B];

  // Calculate RHS Components
  const num = sub(tanA, tanB);
  
  const prod = mul(tanA, tanB);
  const one = Val(1,0,0,0,1);
  const den = add(one, prod);
  
  const RHS = divScalar(num, den);

  content.innerHTML+=`
    <hr style="border:0;border-top:1px solid #eee;margin:20px 0;">

    <div class="step-header">Step 1: Evaluate LHS</div>
    <div class="line">
      ⇒ tan(${A}° − ${B}°) = tan(${A-B}°)
    </div>
    <div class="line">
      ⇒ <b>${valHTML(tanDiff)}</b>
    </div>

    <div class="step-header">Step 2: Evaluate RHS</div>
    <div class="sub-step"><b>2a. Numerator (tanA − tanB):</b></div>
    <div class="line">
      ⇒ ${valHTML(tanA)} − ${valHTML(tanB)}
    </div>
    <div class="line">
      ⇒ <b>${valHTML(num)}</b>
    </div>

    <div class="sub-step" style="margin-top:10px;"><b>2b. Denominator (1 + tanA tanB):</b></div>
    <div class="line">
      ⇒ 1 + (${valHTML(tanA)})(${valHTML(tanB)})
    </div>
    <div class="line">
      ⇒ 1 + ${valHTML(prod)}
    </div>
    <div class="line">
      ⇒ <b>${valHTML(den)}</b>
    </div>

    <div class="sub-step" style="margin-top:10px;"><b>2c. Divide Numerator by Denominator:</b></div>
    <div class="line">
       ⇒ <span class="frac"><span class="num">${valHTML(num)}</span><span class="den">${valHTML(den)}</span></span>
    </div>
    <div class="line">
      ⇒ ${valHTML(RHS)}
    </div>

    <div class="step-header">Step 3: Conclusion</div>
    <div class="line">
      <span class="box">${valHTML(tanDiff)} = ${valHTML(RHS)}</span>
    </div>
    <div class="line"><b>Identity Verified.</b></div>
  `;
  prompt.textContent="Press y for next question or n to exit.";
  stage="a";
}

gen(); showQ();

window.addEventListener("keydown",e=>{
  const k=(e.key||"").toLowerCase();
  if(stage==="q") showA();
  else{
    if(k==="y"){ gen(); showQ(); prompt.textContent="Press any key to reveal the solution."; }
    if(k==="n"){ document.getElementById("card").innerHTML="<div class='q'>Session ended.</div>"; }
  }
});
})();
</script>
</body>
</html>