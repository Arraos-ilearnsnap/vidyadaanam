<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Trigonometric Expression Evaluation</title>

<style>
body{
  margin:0;
  padding:24px;
  font-family:"Segoe UI", Roboto, Arial, sans-serif;
  background:#ffffff;
  color:#111;
}
.card{
  max-width:900px;
  margin:auto;
  padding:28px;
  border-radius:12px;
  box-shadow:0 8px 26px rgba(0,0,0,0.08);
}
.q{ font-size:18px; font-weight:700; margin-bottom:14px; }
.line{ font-size:16px; margin:8px 0; line-height:1.7; }
.frac{
  display:inline-block;
  text-align:center;
  vertical-align:middle;
  margin:0 4px;
}
.frac .num{ display:block; border-bottom:1px solid #111; padding:0 6px; }
.frac .den{ display:block; padding:0 6px; }
.box{
  display:inline-block;
  padding:6px 14px;
  border:2px solid #111;
  font-weight:700;
}
.prompt{
  margin-top:16px;
  font-size:13px;
  font-style:italic;
  color:#555;
}
</style>
</head>

<body>
<main class="card" id="card">
  <div id="content"></div>
  <div class="prompt" id="prompt">
    Press any key to reveal the solution. After reveal press <b>y</b> for next or <b>n</b> to exit.
  </div>
</main>

<script>
(function(){
"use strict";

/* ===================== ENGINE (UNCHANGED) ===================== */

function Val(a,b,c,d,k){ return {a,b,c,d,k}; }
function gcd(x,y){ return y?gcd(y,x%y):Math.abs(x); }

function simplify(v){
  if(v.a===0 && v.b===0 && v.c===0 && v.d===0) return Val(0,0,0,0,1);
  let g=gcd(gcd(gcd(gcd(Math.abs(v.a),Math.abs(v.b)),Math.abs(v.c)),Math.abs(v.d)),v.k);
  return Val(v.a/g,v.b/g,v.c/g,v.d/g,v.k/g);
}

function add(v1,v2){
  let k=v1.k*v2.k;
  return simplify(Val(
    v1.a*v2.k+v2.a*v1.k,
    v1.b*v2.k+v2.b*v1.k,
    v1.c*v2.k+v2.c*v1.k,
    v1.d*v2.k+v2.d*v1.k,
    k
  ));
}

function sub(v1,v2){
  return add(v1,Val(-v2.a,-v2.b,-v2.c,-v2.d,v2.k));
}

function mul(v1,v2){
  return simplify(Val(
    v1.a*v2.a + 2*v1.b*v2.b + 3*v1.c*v2.c + 6*v1.d*v2.d,
    v1.a*v2.b + v1.b*v2.a + 3*(v1.c*v2.d + v1.d*v2.c),
    v1.a*v2.c + v1.c*v2.a + 2*(v1.b*v2.d + v1.d*v2.b),
    v1.a*v2.d + v1.d*v2.a + v1.b*v2.c + v1.c*v2.b,
    v1.k*v2.k
  ));
}

/* ===================== DISPLAY (UNCHANGED) ===================== */

function fracHTML(num,den){
  return `<span class="frac"><span class="num">${num}</span><span class="den">${den}</span></span>`;
}

function numHTML(v){
  let s=[];
  if(v.a) s.push(`${v.a}`);
  if(v.b) s.push(v.b===1?"√2":v.b===-1?"−√2":`${v.b}√2`);
  if(v.c) s.push(v.c===1?"√3":v.c===-1?"−√3":`${v.c}√3`);
  if(v.d) s.push(v.d===1?"√6":v.d===-1?"−√6":`${v.d}√6`);
  if(!s.length) return "0";
  return s.join(" + ").replace(/\+\s−/g,"− ");
}

function valHTML(v){
  let n=numHTML(v);
  return v.k===1?n:fracHTML(n,v.k);
}

/* ===================== TRIG TABLE (UNCHANGED) ===================== */

const trig={
  sin:{0:Val(0,0,0,0,1),30:Val(1,0,0,0,2),45:Val(0,1,0,0,2),60:Val(0,0,1,0,2),90:Val(1,0,0,0,1)},
  cos:{0:Val(1,0,0,0,1),30:Val(0,0,1,0,2),45:Val(0,1,0,0,2),60:Val(1,0,0,0,2),90:Val(0,0,0,0,1)},
  tan:{0:Val(0,0,0,0,1),30:Val(0,0,1,0,3),45:Val(1,0,0,0,1),60:Val(0,0,1,0,1)},
  sec:{0:Val(1,0,0,0,1),30:Val(0,0,2,0,1),45:Val(0,2,0,0,1),60:Val(2,0,0,0,1)},
  cosec:{30:Val(2,0,0,0,1),45:Val(0,2,0,0,1),60:Val(0,0,2,0,1),90:Val(1,0,0,0,1)},
  cot:{30:Val(0,0,3,0,1),45:Val(1,0,0,0,1),60:Val(0,0,1,0,3)}
};

const funcs=Object.keys(trig);
const angles=[0,30,45,60,90];

function pick(){
  let f,a;
  do{
    f=funcs[Math.random()*funcs.length|0];
    a=angles[Math.random()*angles.length|0];
  }while(!trig[f][a]);
  return {f,a};
}

/* ===================== FLOW (4 TERMS × SAME FUNCTION) ===================== */

const content=document.getElementById("content");
const prompt=document.getElementById("prompt");
let stage="q",terms=[],ops=[];

function gen(){
  terms=[ pick(), pick(), pick(), pick() ];
  ops=[
    Math.random()<0.5?"+":"−",
    Math.random()<0.5?"+":"−",
    Math.random()<0.5?"+":"−"
  ];
}

function showQ(){
  content.innerHTML=`
    <div class="q">Evaluate:</div>
    <div class="line">
      ${terms[0].f} ${terms[0].a}° ${terms[0].f} ${terms[0].a}°
      ${ops[0]}
      ${terms[1].f} ${terms[1].a}° ${terms[1].f} ${terms[1].a}°
      ${ops[1]}
      ${terms[2].f} ${terms[2].a}° ${terms[2].f} ${terms[2].a}°
      ${ops[2]}
      ${terms[3].f} ${terms[3].a}° ${terms[3].f} ${terms[3].a}°
    </div>`;
  stage="q";
}

function showA(){
  let P=[];
  for(let i=0;i<4;i++){
    const V=trig[terms[i].f][terms[i].a];
    P[i]=mul(V,V);
  }

  let R=P[0];
  R=ops[0]==="+"?add(R,P[1]):sub(R,P[1]);
  R=ops[1]==="+"?add(R,P[2]):sub(R,P[2]);
  R=ops[2]==="+"?add(R,P[3]):sub(R,P[3]);

  content.innerHTML+=`
    <div class="line">
      ⇒ (${valHTML(trig[terms[0].f][terms[0].a])}) × (${valHTML(trig[terms[0].f][terms[0].a])})
      ${ops[0]}
      (${valHTML(trig[terms[1].f][terms[1].a])}) × (${valHTML(trig[terms[1].f][terms[1].a])})
      ${ops[1]}
      (${valHTML(trig[terms[2].f][terms[2].a])}) × (${valHTML(trig[terms[2].f][terms[2].a])})
      ${ops[2]}
      (${valHTML(trig[terms[3].f][terms[3].a])}) × (${valHTML(trig[terms[3].f][terms[3].a])})
    </div>

    <div class="line">
      ⇒ ${valHTML(P[0])} ${ops[0]} ${valHTML(P[1])} ${ops[1]} ${valHTML(P[2])} ${ops[2]} ${valHTML(P[3])}
    </div>

    <div class="line">
      ⇒ <span class="box">${valHTML(R)}</span>
    </div>`;
  prompt.textContent="Press y for next question or n to exit.";
  stage="a";
}

gen(); showQ();

window.addEventListener("keydown",e=>{
  const k=(e.key||"").toLowerCase();
  if(stage==="q") showA();
  else{
    if(k==="y"){ gen(); showQ(); prompt.textContent="Press any key to reveal the solution."; }
    if(k==="n"){ document.getElementById("card").innerHTML="<div class='q'>Session ended.</div>"; }
  }
});
})();
</script>
</body>
</html>
